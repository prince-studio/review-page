<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Suggested Review</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
  body{
    margin:0;
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
    background:#f5f7f8;
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
  }
  .wrap{
    width:100%;
    max-width:420px;
    text-align:center;
    padding:24px;
  }
  h1{
    margin:0 0 16px;
    color:#198754;
    font-size:26px;
  }

  /* REVIEW BOX */
  .review-box{
    background:#ffffff;
    border-radius:12px;
    padding:18px 16px;
    min-height:90px;
    box-shadow:0 4px 14px rgba(0,0,0,0.06);
    font-size:15px;
    line-height:1.5;
    text-align:left;
    color:#9aa0a6;
    margin-bottom:18px;
    position:relative;
  }

  /* LOADING SPINNER */
  .spinner {
    width:26px;
    height:26px;
    border:3px solid #ddd;
    border-top-color:#198754;
    border-radius:50%;
    animation: spin 0.8s linear infinite;
    margin: 0 auto;
    margin-top:4px;
  }
  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  /* BUTTON (hidden initially) */
  button{
    width:100%;
    border:none;
    border-radius:999px;
    padding:12px 18px;
    font-size:16px;
    font-weight:600;
    cursor:pointer;
    background:#198754;
    color:#fff;
    box-shadow:0 6px 18px rgba(0,0,0,0.18);
    opacity:0;           /* hidden */
    pointer-events:none; /* disabled until fade-in */
    transition:opacity .6s ease;
  }
  button.show {
    opacity:1;
    pointer-events:auto;
  }
  button:hover{
    transform:translateY(-1px);
    box-shadow:0 10px 24px rgba(0,0,0,0.22);
    opacity:.96;
  }
</style>
</head>
<body>
<div class="wrap">
  <h1>Suggested Review</h1>

  <div id="reviewBox" class="review-box">
    <div class="spinner"></div>
  </div>

  <button id="copyBtn">Copy &amp; Open Google</button>
</div>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbx579TE5jN8VcMWzrAjzLlaieDpk02zglUH0mmQsEb9NKnQnCz6f33iYRGxcEqnwp-pGw/exec";
  const GOOGLE_REVIEW_URL = "https://g.page/r/CVkZtJEDPD28EBM/review";

  const reviewBox = document.getElementById("reviewBox");
  const copyBtn = document.getElementById("copyBtn");

  let currentReviewText = "";

  async function loadReview() {
    try {
      const res = await fetch(API_URL, { cache: "no-store" });
      const data = await res.json();

      currentReviewText = data.text || "";
      reviewBox.textContent = currentReviewText;

      // Fade-in button
      copyBtn.classList.add("show");

      console.log("Review:", data.index);

    } catch (err) {
      console.error("Error loading review:", err);
      reviewBox.textContent = "Review text load nahi ho paaya. Thodi der baad phir try karein.";
    }
  }

  copyBtn.addEventListener("click", async () => {
    if (!currentReviewText) return;
    try {
      await navigator.clipboard.writeText(currentReviewText);
    } catch (err) {
      const ta = document.createElement("textarea");
      ta.value = currentReviewText;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      document.body.removeChild(ta);
    }

    window.open(GOOGLE_REVIEW_URL, "_blank");
  });

  loadReview();
</script>
</body>
</html>
